# New CMS + API + Web Starter
This project provides a CMS-backed web application stack with Strapi, NestJS and Angular.
It has basic support for multi-tenant installs and enterprise authentication.


Fill out the sections below as appropriate,
then remove everything from line 12 to line 1.
  
  
  
  
---------------
# [Project Name]
[Project Description]


|	Project Meta	|				|
|	---				|	----		|
| Built With		|	NestJS ^11.1.x, Strapi ^5.0.0, Angular ^18.2.x |
| Primary Contact	|	Michael May	|

## Introduction
See individual README files for more information.

## Quickstart
Below are some instructions to get you up and running quickly.
Any keys used from env samples below should be considered compromised and not production safe.
Generate new keys and tokens for production use.

### CMS
- From `apps/cms`.
- Run `npm i`.
- Create an `.env` file similar to below:
```
# Server
HOST=0.0.0.0
PORT=1337

# Secrets
APP_KEYS=DHasoVWyKiL3ZFsNLlcpJw==,fCDpMYBLODgqe4ut2Ij6ag==,vTSBeQ7THT+ORln0EYkfRQ==,+6JxsWA3VaTG72UfxWR/+w==
API_TOKEN_SALT=IYfLWMC3DyGdn0/F++X5Pw==
ADMIN_JWT_SECRET=vpXBdlifwu1zbktMww/33g==
TRANSFER_TOKEN_SALT=5zwSZoCTNTsEDDzyzcZJFA==

# Database
DATABASE_URL=postgres://postgres:@localhost:5432/your_cms_database_name
DATABASE_CLIENT=postgres
JWT_SECRET=Vw1MVYNWgCuEYEpH2lgskw==
```
_Note:_ New keys can be generated by running `node apps/cms/tools/crypto.mjs`.
- Create a local postgres database matching `your_cms_database_name` in the env.
- Start the application with `npm run develop`.
- This should automatically load the initial user setup. If not open [this link](http://localhost:1337/admin/auth/register-admin).
- Set up an admin account.
- Once logged in, create an API token [here](http://localhost:1337/admin/settings/api-tokens/create) (Unlimited duration, Read-only).
- Note the token. This will be the API's `STRAPI_TOKEN` env value.

### API
- From `apps/api`.
- Run `npm i`.
- Create an `.env` file similar to below:
```
LOCALHOST=true
DEBUG=true
SWAGGER_ENABLE=true
ORIGINS=localhost
## DB
DATABASE_URL=postgres://postgres:@localhost:5432/your_api_database_name
DATABASE_SYNCHRONIZE=true
## AWS
AWS_SES_REGION=us-east-1
AWS_ACCESS_KEY_ID=your-aws-access-key-id
AWS_SECRET_ACCESS_KEY=your-aws-secret
## Signing
PII_SIGNING_KEY=VLhUN3bUKMwKFPgNKDkLqVUExiEC0Isj1Da7m8Be1BE6t0LkFQ2Tz8zGvxL2k5uoSFaBH5+Cci+m9/NKsONxoA==
PII_SIGNING_OFFSET=95efebfb4dc0b4eb
PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQCfsbaO2moxRV6s\nwDAy3cFtuCEh4ROr+Wf4j0mf2b4JykUx3e+iHF91BwcGd4fDCerqRaiSKL1sgZVf\nYEOtym8v7unULOlKcyYnO2Nec45M9ShnH5+qPeu/FUzDw7NKsp2P5tdaDNdgaQsT\njmBtj4Xlbai9LkUBtFhK4KEMWlLhKzqV3MBeiydGS+NhHJr+hg78NgMuAzbKSAUD\nrOPj4jb61LSrzScfUv5uua/SnlA+FwrncGyedCFARNnAOVX9G+87SdPClgXNFJRc\nagLE/SCmUm3v/hwZUwoZxgG80XbAo8NVRJ0dCWwry5nYb0d5zL+M3zFgJIyfm5TN\nXeBVKZgNAgMBAAECggEAJXiT40+1OLP0C9l5xcm6bCYXIiW30bPPNWfbyPYU7SOo\n2lNe+f0p2eIpABe2g6mVVVy8efU0w1vhopRKNSKJtefbtpVGNVmxE2YQQjafpoek\n8BOfyZjHcxoKnenS7V1dcslh8SePtvfW6UMQdczGSIgTXraXaxe32vP73hPonBxD\ndeSURGeP2fnm27NTQJyliX0caOP8Ek3w3GpoDFW6oH3ScF/xY6dA0IoPEeUm1CfW\nARl6P+nwiWXngQh2sBDiOZ978drpm0RT35pzqF3fs+BOK6cs6iLPB3E7djFE71Rz\nqsJn8+1gCPKphTJ5mZ5S8UkrOYlJzwIOzOwoGLp2cQKBgQDOaCEhRBPoNmv6QQuT\nyf4PvRnKlA8Yn463GXJi0GMpxXE7AZveD06KI8rfOAHwoKBBCMKOP2J1nZBsrxiO\nNwQ/CsiQjN4p70HGwMgPLUSDW/u1m1oPd5SFjEqz3ngSa9JDbKohkb+6m1AejqeU\n1rmPrs9ZQ4oSBvI+5nrAkRewcQKBgQDGEFdY4oIhJm190HFmoRpxJ4BwuEdUpRty\nTwHzByfrai2tE75MFi3Bz410aDcjAllOtYXa2ixxyujIqX+TUkiTr08fnsyU1UWd\nLXRbs0wOLTW0CDkuF5Ve9FVcs+HFCvwXlpBOtyCoiC0ZAy/NPPCowUwlKTN/DpxY\nbbDC2aXvXQKBgF0pSqrFG2cYCSxu51bROMbJxzZUFWw7uCKUbbiD7f4Qi8biNwPH\nTN+0wAB4Owfst+gimA20NjB36ZPkg+TMmDIMH/J+YlfzEXEv2hxfhijz/2w8ri2E\n/5g3dhAxPWizGbgs960nJ66GI2dnY+Qd9qsPb68OeOciE3yococv9c1BAoGAD9bU\ntWX/1BjXnr0hpHxzueLX0avbAHjntf99f2ruFVR7bKDskfcgF6S6gjmnVyRj8fhw\nSO0zqrH4ZbuwWR62cSEO6c9wOuLHW2d8K60uAuA4sDoMIJSAPIS7ots7zd8wA87l\noXXhpbimKp7nnrkl4cj7hulBlgKcHDJBdYOkUn0CgYAfPXoRp5dtEQjk1SLScI2q\ngS53Ffww4hpgE7q3ys0wBA0GHR5u/BORQwJYC2NNHRz1RGvJ/WB4uP14G/P1Fnb3\nPOpC8Hi3XsMz3oCBjq1oH0j4+YuMfTr07ebJKNJhMUKK1YqadyRz1hSh2flM5DUB\n4mKh1L2LWqw9ricGIvIRuw==\n-----END PRIVATE KEY-----\n"
PUBLIC_KEY="-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAn7G2jtpqMUVerMAwMt3B\nbbghIeETq/ln+I9Jn9m+CcpFMd3vohxfdQcHBneHwwnq6kWokii9bIGVX2BDrcpv\nL+7p1CzpSnMmJztjXnOOTPUoZx+fqj3rvxVMw8OzSrKdj+bXWgzXYGkLE45gbY+F\n5W2ovS5FAbRYSuChDFpS4Ss6ldzAXosnRkvjYRya/oYO/DYDLgM2ykgFA6zj4+I2\n+tS0q80nH1L+brmv0p5QPhcK53BsnnQhQETZwDlV/RvvO0nTwpYFzRSUXGoCxP0g\nplJt7/4cGVMKGcYBvNF2wKPDVUSdHQlsK8uZ2G9Hecy/jN8xYCSMn5uUzV3gVSmY\nDQIDAQAB\n-----END PUBLIC KEY-----\n"
## STRAPI
STRAPI_HOST=http://localhost:1337
STRAPI_TOKEN=YOUR-STRAPI-TOKEN
```
- Create a local postgres database matching `your_api_database_name` in the env.
- Fill in AWS credentials and `YOUR-STRAPI-TOKEN`.
- Run `npm run start:dev` to synchronize the initial database structure.
- Run `npm run console:dev InstallOrganization` to set up an initial organization and user.
  - Choose a name.
  - Accept the default slug.
    - Note the `organizationId` in the logs
  - Enter `y` to install a user.
  - Enter `y` to install an `Authentication Strategy`.
  - Type `CodeAuth`.
  - Choose `0`.
  - Accept the default length.
  - Accept the default lifetime.
  - Add your email.
  - Add your first name.
  - Add your last name.
  - Accept the default (SuperAdmin) role.
- If not still running, run `npm run start:dev`.

## Web
- From `apps/api`.
- Run `npm i`.
- Create an `.env` file similar to below:
```
LOCALHOST=true
PRODUCTION=false
API_SETTINGS={"localhost":[{"name":"Test (Local)","endpoint":"http://localhost:8001","organizationId":"YOUR-ORGANIZATION-ID","production":false,"locale":"en-US"}]}
```
- Fill in `YOUR-ORGANIZATION-ID`.
- Run `npm run start:dev`.
- The app should be live [here](http://localhost:4200)

## Deploying
Sample github actions workflows are provided in `.github/workflows-disabled`.
If you're deploying on Heroku, these should be good for most use cases.  

Be sure to change `YOUR-APP-NAME` in the `web.yml` and `api.yml` file to your actual Heroku app names.

When you're ready to activate the actions, rename the folder to `.github/workflows`.